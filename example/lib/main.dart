import 'dart:convert';
import 'dart:math';

import 'package:common_utils/common_utils.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'dart:async';

import 'package:high_chart/high_chart.dart';
import 'package:high_chart_example/sjson.dart';
import 'package:pretty_json/pretty_json.dart';

// import 'sjson.dart' as sj;

void main() {
  runApp(MyApp());
}

class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() => _MyAppState();
}

class _MyAppState extends State<MyApp> {
  @override
  void initState() {
    super.initState();
    initPlatformState();
  }

  // Platform messages are asynchronous, so we initialize in an async method.
  Future<void> initPlatformState() async {
    // Platform messages may fail, so we use a try/catch PlatformException.
    // We also handle the message potentially returning null.

    // If the widget was removed from the tree while the asynchronous platform
    // message was in flight, we want to discard the reply rather than calling
    // setState to update our non-existent appearance.
    if (!mounted) return;
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Plugin example app'),
        ),
        body: Container(
          child: Column(
            children: [
              Container(
                height: 500,
                child: HignChart(
                  data: [
                    [
                      [99, 0.562],
                      [89, 1.856]
                    ],
                    [
                      [100, 0.12],
                      [120, 0.52]
                    ]
                  ],
                  option: json.encode(option).replaceAll('\\"', '\''),
                ),
              ),
              CupertinoButton(
                  child: Text('zzzzz'),
                  onPressed: () {
                    print(json.encode([
                      {"aa": 'a'},
                      {
                        "aa1": {'aa': "xxxx"}
                      }
                    ]));

                    setState(() {});
                  })
            ],
          ),
        ),
      ),
    );
  }

  dynamic myEncode(dynamic item) {
    return 'aaa';
    print(item);
    if (item is DateTime) {
      return item.toIso8601String();
    }
    return item;
  }

  List<List> get data {
    var i = 0;
    return [
      [
        '''{
          "close": 5432,
          "high": 5433.000000000001,
          "low": 5428,
          "open": 5430,
          "tips":
              "\u003cb\u003e◉ 9805\u003c/b\u003e\u003cbr\u003e5433 → 0000 ▲ 0046\u003cbr\u003e5432 → 0000 ▲ 0039\u003cbr\u003e5432 → 0059 ▲ 0415\u003cbr\u003e5431 → 0000 ▲ 0335\u003cbr\u003e5431 → 0555 ▲ 1845\u003cbr\u003e5430 → 0541 ▼ 0305\u003cbr\u003e5430 → 2470 ▼ 1366\u003cbr\u003e5429 → 0129 ▲ 0265\u003cbr\u003e5429 → 0429 ▲ 0714\u003cbr\u003e5428 → 0292 ▼ 0000\u003cbr\u003e\u003cb\u003e⊗ 855\u003c/b\u003e",
          "x": 1626073140000
        }'''
      ]
    ];
  }

  Map get option => {
        "__isStock": false,
        "extension": {"layout": "single", "col": 12, "height": "500px"},
        "chart": {
          "type": "area",
          "zoomType": "xy",
          "spacingTop": 5,
          "spacingLeft": 0,
          "spacingRight": 10,
          "spacingBottom": 10,
          "backgroundColor": "rgba(0,0,0,0)"
        },
        "title": {
          "text": "ETH_USDT Market Depth",
          "style": {"color": "#323f4b", "fontSize": 16}
        },
        "xAxis": {
          "minPadding": 0,
          "maxPadding": 0,
          "plotLines": [
            {
              "color": "#888",
              "value": 0.1523,
              "width": 1,
              "label": {"text": "Actual price", "rotation": 90}
            }
          ],
          "title": {"text": "Price"},
          "labels": {
            "style": {"color": "#9aa5b1", "fontSize": 12}
          }
        },
        "yAxis": [
          {
            "lineWidth": 1,
            "gridLineWidth": 1,
            "title": null,
            "tickWidth": 1,
            "tickLength": 5,
            "tickPosition": "inside",
            "labels": {
              "style": {"color": "#9aa5b1", "fontSize": 12}
            },
            "opposite": false
          },
          {
            "opposite": true,
            "linkedTo": 0,
            "lineWidth": 1,
            "gridLineWidth": 0,
            "title": null,
            "tickWidth": 1,
            "tickLength": 5,
            "tickPosition": "inside",
            "labels": {
              "style": {"color": "#9aa5b1", "fontSize": 12}
            }
          }
        ],
        "legend": {"enabled": false},
        "plotOptions": {
          "area": {"fillOpacity": 0.2, "lineWidth": 1, "step": "center"}
        },
        "tooltip": {
          "headerFormat":
              "<span style=\"font-size=10px;\">Price: {point.key}</span><br/>",
          "valueDecimals": 2
        },
        "series": [
          {
            "name": "Bids",
            "data": [
              [102.25765023541214, 0.504129486274992],
              [102.25739706311997, 0.5041396702682984],
              [102.1133899774373, 0.5057698224138745],
              [102.01828577308981, 0.5103099820873367],
              [101.83477496084672, 0.515162655601145],
              [101.73367112849247, 0.517650842103699],
              [101.64042372607909, 0.5178292192846494],
              [101.55959094227896, 0.5189999736024662],
              [101.39658070711444, 0.5251326421610198],
              [101.21741827084276, 0.5304099032593423],
              [101.05405804587762, 0.5342782863155566],
              [100.99925213402175, 0.5360423077223312],
              [100.89965112782807, 0.539809768674268],
              [100.73961653951004, 0.5420792088730061],
              [100.57235192322335, 0.5427833870121038],
              [100.46133395722633, 0.5445390273552617],
              [100.40160857951102, 0.5451508145514266],
              [100.22318930868008, 0.5520521075192446],
              [100.13258147506208, 0.5541951762126472],
              [99.99853377267497, 0.5581761150086418],
              [99.94384540063811, 0.5603571534929815],
              [99.81210947366964, 0.5658529942749244],
              [99.77349888089007, 0.5666971164343213],
              [99.62368582688573, 0.5710657760096277],
              [99.61900205287085, 0.5712429512953044],
              [99.54020221627732, 0.5730205775940894],
              [99.37999017315457, 0.5764865662594084],
              [99.29294894736695, 0.5771851397497225],
              [99.1518842614125, 0.5784635966981481],
              [99.03036216318363, 0.5829411820012043],
              [98.95537569568268, 0.5835705971254466],
              [98.80416681275183, 0.5872125862014596],
              [98.70909821296615, 0.5878526422117772],
              [98.6458606814623, 0.5901070899490527],
              [98.5651094192321, 0.5939680485906313],
              [98.46315502307577, 0.5967186894696405],
              [98.38028177165552, 0.5979116437330337],
              [98.37446257491236, 0.5979203978050134],
              [98.2067441311419, 0.601538167156597],
              [98.0616758847708, 0.6060703711230521],
              [97.91665456344212, 0.612186877911088],
              [97.83706492495634, 0.6132105993949551],
              [97.8045212830116, 0.6143547303746977],
              [97.66339117949387, 0.6206880053983662],
              [97.62443281447332, 0.6208882599149119],
              [97.52418987116447, 0.6252179131591867],
              [97.35397227239162, 0.6295070211639967],
              [97.20033035369858, 0.6317495736069646],
              [97.1450016846035, 0.633422751045731],
              [96.99758410658421, 0.6355423040005854]
            ],
            "color": "#03a7a8"
          },
          {
            "name": "Asks",
            "data": [
              [102.44014784120367, 0.4940936629904284],
              [102.44040146532842, 0.49410384698373483],
              [102.58466627251963, 0.49573399912931093],
              [102.68020940419174, 0.5002741588027732],
              [102.86491088673739, 0.5051268323165815],
              [102.9670374609791, 0.5076150188191355],
              [103.0614153465988, 0.5077933960000859],
              [103.14337821923793, 0.5089641503179027],
              [103.30893054357465, 0.5150968188764563],
              [103.49147200163695, 0.5203740799747789],
              [103.6585024439954, 0.5242424630309932],
              [103.71472085677284, 0.5260064844377678],
              [103.81699973840975, 0.5297739453897046],
              [103.98166146546072, 0.5320433855884427],
              [104.15430906233787, 0.5327475637275404],
              [104.26928101358301, 0.5345032040706983],
              [104.33127025807474, 0.5351149912668631],
              [104.51667275737404, 0.5420162842346812],
              [104.61116216008442, 0.5441593529280838],
              [104.7512053480761, 0.5481402917240784],
              [104.80849291693595, 0.5503213302084181],
              [104.94664093308675, 0.555817170990361],
              [104.98723773079013, 0.5566612931497579],
              [105.14487937804464, 0.5610299527250643],
              [105.14982272911362, 0.561207128010741],
              [105.23299751181719, 0.562984754309526],
              [105.40237222836305, 0.566450742974845],
              [105.49468811271456, 0.5671493164651591],
              [105.64456355912084, 0.5684277734135846],
              [105.77404318652087, 0.5729053587166408],
              [105.85413601541288, 0.5735347738408831],
              [106.0158865574928, 0.5771767629168961],
              [106.11789421784947, 0.5778168189272138],
              [106.18587816056817, 0.5800712666644893],
              [106.272801662814, 0.5839322253060679],
              [106.38272879002176, 0.586682866185077],
              [106.47226769041269, 0.5878758204484703],
              [106.47856552837598, 0.58788457452045],
              [106.6601006426515, 0.5915023438720336],
              [106.81765595002766, 0.5960345478384886],
              [106.97562630355606, 0.6021510546265245],
              [107.06257935012664, 0.6031747761103917],
              [107.09819168427346, 0.6043189070901342],
              [107.25273238117259, 0.6106521821138028],
              [107.29551597743209, 0.6108524366303485],
              [107.40568940446607, 0.6151820898746233],
              [107.59315405881617, 0.6194711978794333],
              [107.76295523119751, 0.6217137503224012],
              [107.8242963899055, 0.6233869277611676],
              [107.9879198018134, 0.625506480716022]
            ],
            "color": "#fc5857"
          }
        ]
      };
}
